!function(){var t={9662:function(t,n,e){var r=e(614),o=e(6330),i=TypeError;t.exports=function(t){if(r(t))return t;throw i(o(t)+" is not a function")}},9670:function(t,n,e){var r=e(111),o=String,i=TypeError;t.exports=function(t){if(r(t))return t;throw i(o(t)+" is not an object")}},1318:function(t,n,e){var r=e(5656),o=e(1400),i=e(6244),a=function(t){return function(n,e,a){var c,u=r(n),s=i(u),f=o(a,s);if(t&&e!=e){for(;s>f;)if((c=u[f++])!=c)return!0}else for(;s>f;f++)if((t||f in u)&&u[f]===e)return t||f||0;return!t&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}},3658:function(t,n,e){"use strict";var r=e(9781),o=e(3157),i=TypeError,a=Object.getOwnPropertyDescriptor,c=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=c?function(t,n){if(o(t)&&!a(t,"length").writable)throw i("Cannot set read only .length");return t.length=n}:function(t,n){return t.length=n}},4326:function(t,n,e){var r=e(1702),o=r({}.toString),i=r("".slice);t.exports=function(t){return i(o(t),8,-1)}},9920:function(t,n,e){var r=e(2597),o=e(3887),i=e(1236),a=e(3070);t.exports=function(t,n,e){for(var c=o(n),u=a.f,s=i.f,f=0;f<c.length;f++){var l=c[f];r(t,l)||e&&r(e,l)||u(t,l,s(n,l))}}},8880:function(t,n,e){var r=e(9781),o=e(3070),i=e(9114);t.exports=r?function(t,n,e){return o.f(t,n,i(1,e))}:function(t,n,e){return t[n]=e,t}},9114:function(t){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},8052:function(t,n,e){var r=e(614),o=e(3070),i=e(6339),a=e(3072);t.exports=function(t,n,e,c){c||(c={});var u=c.enumerable,s=void 0!==c.name?c.name:n;if(r(e)&&i(e,s,c),c.global)u?t[n]=e:a(n,e);else{try{c.unsafe?t[n]&&(u=!0):delete t[n]}catch(t){}u?t[n]=e:o.f(t,n,{value:e,enumerable:!1,configurable:!c.nonConfigurable,writable:!c.nonWritable})}return t}},3072:function(t,n,e){var r=e(7854),o=Object.defineProperty;t.exports=function(t,n){try{o(r,t,{value:n,configurable:!0,writable:!0})}catch(e){r[t]=n}return n}},9781:function(t,n,e){var r=e(7293);t.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4154:function(t){var n="object"==typeof document&&document.all,e=void 0===n&&void 0!==n;t.exports={all:n,IS_HTMLDDA:e}},317:function(t,n,e){var r=e(7854),o=e(111),i=r.document,a=o(i)&&o(i.createElement);t.exports=function(t){return a?i.createElement(t):{}}},7207:function(t){var n=TypeError;t.exports=function(t){if(t>9007199254740991)throw n("Maximum allowed index exceeded");return t}},8113:function(t){t.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},7392:function(t,n,e){var r,o,i=e(7854),a=e(8113),c=i.process,u=i.Deno,s=c&&c.versions||u&&u.version,f=s&&s.v8;f&&(o=(r=f.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!o&&a&&(!(r=a.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=a.match(/Chrome\/(\d+)/))&&(o=+r[1]),t.exports=o},748:function(t){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:function(t,n,e){var r=e(7854),o=e(1236).f,i=e(8880),a=e(8052),c=e(3072),u=e(9920),s=e(4705);t.exports=function(t,n){var e,f,l,p,d,v=t.target,h=t.global,y=t.stat;if(e=h?r:y?r[v]||c(v,{}):(r[v]||{}).prototype)for(f in n){if(p=n[f],l=t.dontCallGetSet?(d=o(e,f))&&d.value:e[f],!s(h?f:v+(y?".":"#")+f,t.forced)&&void 0!==l){if(typeof p==typeof l)continue;u(p,l)}(t.sham||l&&l.sham)&&i(p,"sham",!0),a(e,f,p,t)}}},7293:function(t){t.exports=function(t){try{return!!t()}catch(t){return!0}}},4374:function(t,n,e){var r=e(7293);t.exports=!r((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},6916:function(t,n,e){var r=e(4374),o=Function.prototype.call;t.exports=r?o.bind(o):function(){return o.apply(o,arguments)}},6530:function(t,n,e){var r=e(9781),o=e(2597),i=Function.prototype,a=r&&Object.getOwnPropertyDescriptor,c=o(i,"name"),u=c&&"something"===function(){}.name,s=c&&(!r||r&&a(i,"name").configurable);t.exports={EXISTS:c,PROPER:u,CONFIGURABLE:s}},1702:function(t,n,e){var r=e(4374),o=Function.prototype,i=o.call,a=r&&o.bind.bind(i,i);t.exports=r?a:function(t){return function(){return i.apply(t,arguments)}}},5005:function(t,n,e){var r=e(7854),o=e(614);t.exports=function(t,n){return arguments.length<2?(e=r[t],o(e)?e:void 0):r[t]&&r[t][n];var e}},8173:function(t,n,e){var r=e(9662),o=e(8554);t.exports=function(t,n){var e=t[n];return o(e)?void 0:r(e)}},7854:function(t,n,e){var r=function(t){return t&&t.Math==Math&&t};t.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof e.g&&e.g)||function(){return this}()||this||Function("return this")()},2597:function(t,n,e){var r=e(1702),o=e(7908),i=r({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,n){return i(o(t),n)}},3501:function(t){t.exports={}},4664:function(t,n,e){var r=e(9781),o=e(7293),i=e(317);t.exports=!r&&!o((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},8361:function(t,n,e){var r=e(1702),o=e(7293),i=e(4326),a=Object,c=r("".split);t.exports=o((function(){return!a("z").propertyIsEnumerable(0)}))?function(t){return"String"==i(t)?c(t,""):a(t)}:a},2788:function(t,n,e){var r=e(1702),o=e(614),i=e(5465),a=r(Function.toString);o(i.inspectSource)||(i.inspectSource=function(t){return a(t)}),t.exports=i.inspectSource},9909:function(t,n,e){var r,o,i,a=e(4811),c=e(7854),u=e(111),s=e(8880),f=e(2597),l=e(5465),p=e(6200),d=e(3501),v="Object already initialized",h=c.TypeError,y=c.WeakMap;if(a||l.state){var b=l.state||(l.state=new y);b.get=b.get,b.has=b.has,b.set=b.set,r=function(t,n){if(b.has(t))throw h(v);return n.facade=t,b.set(t,n),n},o=function(t){return b.get(t)||{}},i=function(t){return b.has(t)}}else{var g=p("state");d[g]=!0,r=function(t,n){if(f(t,g))throw h(v);return n.facade=t,s(t,g,n),n},o=function(t){return f(t,g)?t[g]:{}},i=function(t){return f(t,g)}}t.exports={set:r,get:o,has:i,enforce:function(t){return i(t)?o(t):r(t,{})},getterFor:function(t){return function(n){var e;if(!u(n)||(e=o(n)).type!==t)throw h("Incompatible receiver, "+t+" required");return e}}}},3157:function(t,n,e){var r=e(4326);t.exports=Array.isArray||function(t){return"Array"==r(t)}},614:function(t,n,e){var r=e(4154),o=r.all;t.exports=r.IS_HTMLDDA?function(t){return"function"==typeof t||t===o}:function(t){return"function"==typeof t}},4705:function(t,n,e){var r=e(7293),o=e(614),i=/#|\.prototype\./,a=function(t,n){var e=u[c(t)];return e==f||e!=s&&(o(n)?r(n):!!n)},c=a.normalize=function(t){return String(t).replace(i,".").toLowerCase()},u=a.data={},s=a.NATIVE="N",f=a.POLYFILL="P";t.exports=a},8554:function(t){t.exports=function(t){return null==t}},111:function(t,n,e){var r=e(614),o=e(4154),i=o.all;t.exports=o.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:r(t)||t===i}:function(t){return"object"==typeof t?null!==t:r(t)}},1913:function(t){t.exports=!1},2190:function(t,n,e){var r=e(5005),o=e(614),i=e(7976),a=e(3307),c=Object;t.exports=a?function(t){return"symbol"==typeof t}:function(t){var n=r("Symbol");return o(n)&&i(n.prototype,c(t))}},6244:function(t,n,e){var r=e(7466);t.exports=function(t){return r(t.length)}},6339:function(t,n,e){var r=e(1702),o=e(7293),i=e(614),a=e(2597),c=e(9781),u=e(6530).CONFIGURABLE,s=e(2788),f=e(9909),l=f.enforce,p=f.get,d=String,v=Object.defineProperty,h=r("".slice),y=r("".replace),b=r([].join),g=c&&!o((function(){return 8!==v((function(){}),"length",{value:8}).length})),m=String(String).split("String"),w=t.exports=function(t,n,e){"Symbol("===h(d(n),0,7)&&(n="["+y(d(n),/^Symbol\(([^)]*)\)/,"$1")+"]"),e&&e.getter&&(n="get "+n),e&&e.setter&&(n="set "+n),(!a(t,"name")||u&&t.name!==n)&&(c?v(t,"name",{value:n,configurable:!0}):t.name=n),g&&e&&a(e,"arity")&&t.length!==e.arity&&v(t,"length",{value:e.arity});try{e&&a(e,"constructor")&&e.constructor?c&&v(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var r=l(t);return a(r,"source")||(r.source=b(m,"string"==typeof n?n:"")),t};Function.prototype.toString=w((function(){return i(this)&&p(this).source||s(this)}),"toString")},4758:function(t){var n=Math.ceil,e=Math.floor;t.exports=Math.trunc||function(t){var r=+t;return(r>0?e:n)(r)}},3070:function(t,n,e){var r=e(9781),o=e(4664),i=e(3353),a=e(9670),c=e(4948),u=TypeError,s=Object.defineProperty,f=Object.getOwnPropertyDescriptor,l="enumerable",p="configurable",d="writable";n.f=r?i?function(t,n,e){if(a(t),n=c(n),a(e),"function"==typeof t&&"prototype"===n&&"value"in e&&d in e&&!e[d]){var r=f(t,n);r&&r[d]&&(t[n]=e.value,e={configurable:p in e?e[p]:r[p],enumerable:l in e?e[l]:r[l],writable:!1})}return s(t,n,e)}:s:function(t,n,e){if(a(t),n=c(n),a(e),o)try{return s(t,n,e)}catch(t){}if("get"in e||"set"in e)throw u("Accessors not supported");return"value"in e&&(t[n]=e.value),t}},1236:function(t,n,e){var r=e(9781),o=e(6916),i=e(5296),a=e(9114),c=e(5656),u=e(4948),s=e(2597),f=e(4664),l=Object.getOwnPropertyDescriptor;n.f=r?l:function(t,n){if(t=c(t),n=u(n),f)try{return l(t,n)}catch(t){}if(s(t,n))return a(!o(i.f,t,n),t[n])}},8006:function(t,n,e){var r=e(6324),o=e(748).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},5181:function(t,n){n.f=Object.getOwnPropertySymbols},7976:function(t,n,e){var r=e(1702);t.exports=r({}.isPrototypeOf)},6324:function(t,n,e){var r=e(1702),o=e(2597),i=e(5656),a=e(1318).indexOf,c=e(3501),u=r([].push);t.exports=function(t,n){var e,r=i(t),s=0,f=[];for(e in r)!o(c,e)&&o(r,e)&&u(f,e);for(;n.length>s;)o(r,e=n[s++])&&(~a(f,e)||u(f,e));return f}},5296:function(t,n){"use strict";var e={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,o=r&&!e.call({1:2},1);n.f=o?function(t){var n=r(this,t);return!!n&&n.enumerable}:e},2140:function(t,n,e){var r=e(6916),o=e(614),i=e(111),a=TypeError;t.exports=function(t,n){var e,c;if("string"===n&&o(e=t.toString)&&!i(c=r(e,t)))return c;if(o(e=t.valueOf)&&!i(c=r(e,t)))return c;if("string"!==n&&o(e=t.toString)&&!i(c=r(e,t)))return c;throw a("Can't convert object to primitive value")}},3887:function(t,n,e){var r=e(5005),o=e(1702),i=e(8006),a=e(5181),c=e(9670),u=o([].concat);t.exports=r("Reflect","ownKeys")||function(t){var n=i.f(c(t)),e=a.f;return e?u(n,e(t)):n}},4488:function(t,n,e){var r=e(8554),o=TypeError;t.exports=function(t){if(r(t))throw o("Can't call method on "+t);return t}},6200:function(t,n,e){var r=e(2309),o=e(9711),i=r("keys");t.exports=function(t){return i[t]||(i[t]=o(t))}},5465:function(t,n,e){var r=e(7854),o=e(3072),i="__core-js_shared__",a=r[i]||o(i,{});t.exports=a},2309:function(t,n,e){var r=e(1913),o=e(5465);(t.exports=function(t,n){return o[t]||(o[t]=void 0!==n?n:{})})("versions",[]).push({version:"3.30.2",mode:r?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"})},6293:function(t,n,e){var r=e(7392),o=e(7293),i=e(7854).String;t.exports=!!Object.getOwnPropertySymbols&&!o((function(){var t=Symbol();return!i(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},1400:function(t,n,e){var r=e(9303),o=Math.max,i=Math.min;t.exports=function(t,n){var e=r(t);return e<0?o(e+n,0):i(e,n)}},5656:function(t,n,e){var r=e(8361),o=e(4488);t.exports=function(t){return r(o(t))}},9303:function(t,n,e){var r=e(4758);t.exports=function(t){var n=+t;return n!=n||0===n?0:r(n)}},7466:function(t,n,e){var r=e(9303),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},7908:function(t,n,e){var r=e(4488),o=Object;t.exports=function(t){return o(r(t))}},7593:function(t,n,e){var r=e(6916),o=e(111),i=e(2190),a=e(8173),c=e(2140),u=e(5112),s=TypeError,f=u("toPrimitive");t.exports=function(t,n){if(!o(t)||i(t))return t;var e,u=a(t,f);if(u){if(void 0===n&&(n="default"),e=r(u,t,n),!o(e)||i(e))return e;throw s("Can't convert object to primitive value")}return void 0===n&&(n="number"),c(t,n)}},4948:function(t,n,e){var r=e(7593),o=e(2190);t.exports=function(t){var n=r(t,"string");return o(n)?n:n+""}},6330:function(t){var n=String;t.exports=function(t){try{return n(t)}catch(t){return"Object"}}},9711:function(t,n,e){var r=e(1702),o=0,i=Math.random(),a=r(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+a(++o+i,36)}},3307:function(t,n,e){var r=e(6293);t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3353:function(t,n,e){var r=e(9781),o=e(7293);t.exports=r&&o((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},4811:function(t,n,e){var r=e(7854),o=e(614),i=r.WeakMap;t.exports=o(i)&&/native code/.test(String(i))},5112:function(t,n,e){var r=e(7854),o=e(2309),i=e(2597),a=e(9711),c=e(6293),u=e(3307),s=r.Symbol,f=o("wks"),l=u?s.for||s:s&&s.withoutSetter||a;t.exports=function(t){return i(f,t)||(f[t]=c&&i(s,t)?s[t]:l("Symbol."+t)),f[t]}},7658:function(t,n,e){"use strict";var r=e(2109),o=e(7908),i=e(6244),a=e(3658),c=e(7207);r({target:"Array",proto:!0,arity:1,forced:e(7293)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}}()},{push:function(t){var n=o(this),e=i(n),r=arguments.length;c(e+r);for(var u=0;u<r;u++)n[e]=arguments[u],e++;return a(n,e),e}})}},n={};function e(r){var o=n[r];if(void 0!==o)return o.exports;var i=n[r]={exports:{}};return t[r].call(i.exports,i,i.exports,e),i.exports}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),function(){"use strict";const t="activated",n="__timer__",r=async t=>(await chrome.storage.local.get([t]))[t],o=async()=>{const n=await(async()=>await r(t))();chrome.action.setIcon({path:i(n)})},i=t=>[16,32,64,128].reduce(((n,e)=>(n[e]=(t=>t?"/images/icons/started-*.png":"/assets/icons/stopped-*.png")(t).replace("*",e),n)),{});e(7658);const a="screens",c=["id"],u="PK";var s=class{constructor(){this.db=null,this.initialized=!1,this.initializedPromise=null,this.open()}open(){const t=this;this.db&&this.db.close();const n=indexedDB.open("MagicChicken",2);n.onupgradeneeded=t=>{const n=t.target.result;n.objectStoreNames.contains(a)||n.createObjectStore(a,{keyPath:c}).createIndex(u,c,{unique:!0})},this.initializedPromise=new Promise(((e,r)=>{n.onsuccess=n=>{t.db=n.target.result,t.initialized=!0,e()},n.onerror=r}))}getTransaction(t){const n=this,e=(e,o,i=!0)=>{try{e(n.db.transaction([a],t))}catch(t){if("InvalidStateError"==t.name&&i)return n.open(),r(e,o,!1);throw o(),t}},r=(t,r,o=!0)=>{n.initializedPromise.then((()=>e(t,r,o)))};return this.db?new Promise(e):new Promise(r)}getAll(t,n=(()=>{})){this.getTransaction("readonly").then((e=>{const r=e.objectStore(a).openCursor(),o=[];r.onsuccess=n=>{const e=n.target.result;if(!e)return t(o);o.push(e.value),e.continue()},r.onerror=n}))}getByPrimaryIndex(t,n){this.getTransaction("readonly").then((e=>{const r=e.objectStore(a).index(u).get(IDBKeyRange.only(t));r.onsuccess=t=>n(t.target.result),r.onerror=()=>n()}))}delete(t){this.getTransaction("readwrite").then((n=>{const e=n.objectStore(a);e.index(u).get(IDBKeyRange.only(t)).onsuccess=t=>{const n=t.target.result;n&&e.delete([n.id])}}))}insertOrUpdate(t){this.getTransaction("readwrite").then((n=>n.objectStore(a).put(t)))}};const f=["chrome://"],l=async(t={})=>await chrome.tabs.query(t),p=async(t,n=!1,e=(()=>{}))=>{let o=!0;if(!n){const n=await chrome.tabs.get(t);(!n||n.discarded||await(async t=>{const n=(t=>`__except__${new URL(t).origin}`)(t);return await r(n)})(n.url))&&(o=!1)}return o&&await chrome.tabs.discard(t,(n=>{const r=new s;r.getByPrimaryIndex([t],(o=>{o&&r.insertOrUpdate({id:n.id,snapshot:o.snapshot,updated_at:Date.now()}),r.delete([t]),e(t,n)}))}))},d=async t=>{console.log("saveTabPicture"),setTimeout((()=>v(t)),400)},v=async t=>{const n=new s,e=await new Promise((e=>n.getByPrimaryIndex([t.tabId],(t=>e(t)))));if(e&&e.updated_at&&Date.now()-e.updated_at<1e3)return;const r=await chrome.tabs.get(t.tabId);if(f.filter((t=>r.url.startsWith(t))).length>0)return;if(console.log("_saveTabPicture",r.active,r.active,r.status,r),!r.active)return;if(!r.status||"loading"==t.status)return;const o=await chrome.tabs.captureVisibleTab(t.windowId);n.insertOrUpdate({id:t.tabId,snapshot:o,updated_at:Date.now()})},h=async t=>{const e=`${n}${t.tabId}`;await chrome.alarms.clear(e)},y=async t=>{if(!t.tabId)return;const e=`${n}${t.tabId}`;await chrome.alarms.clear(e);const o=await(async()=>await r("ttl")||6e5)();chrome.alarms.create(e,{when:Date.now()+o})},b=async t=>{const e=t.name.replace(n,"");e&&"undefined"!=e&&p(Number(e))};let g=null;chrome.runtime.onInstalled.addListener((()=>{chrome.tabs.onUpdated.addListener(((t,n)=>{console.log("onUpdated",n.status),"complete"==n.status&&(o(),d({tabId:t}))})),chrome.tabs.onReplaced.addListener(o),chrome.tabs.onActivated.addListener((async t=>{console.log("onActivated"),await h(t),g&&y(g),g=t,d(t)})),chrome.tabs.onRemoved.addListener((async t=>{console.log("onRemoved"),g.tabId==t&&(g=void 0),await h({tabId:t}),o(),(()=>{const t=new s;t.getAll((async n=>{const e=(await l()).map((t=>t.id));n.forEach((n=>{e.includes(n.id)||t.delete([n.id])}))}))})()})),chrome.alarms.onAlarm.addListener(b),(()=>{const n={};n[t]=!1,chrome.storage.local.set(n)})(),chrome.commands.onCommand.addListener((async t=>{if("cleanUp"==t)return(async()=>{const t=(await chrome.tabs.query({active:!0}))[0];(await l()).filter((n=>n.id!=t.id)).forEach((t=>!t.discarded&&p(t.id)))})()})),(async()=>{await chrome.alarms.clearAll(),(await l()).forEach(y)})()}))}()}();