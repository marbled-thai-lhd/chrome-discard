!function(){"use strict";const a="activated",e="__timer__",t=async a=>(await chrome.storage.local.get([a]))[a],c=async()=>{const e=await(async()=>await t(a))();chrome.action.setIcon({path:n(e)})},n=a=>[16,32,64,128].reduce(((e,t)=>(e[t]=(a=>a?"/images/icons/started-*.png":"/assets/icons/stopped-*.png")(a).replace("*",t),e)),{}),s=async(a={})=>await chrome.tabs.query(a),r=async(a,e=!1,c=(()=>{}))=>{let n=!0;if(!e){const e=await chrome.tabs.get(a);(!e||e.discarded||await(async a=>{const e=(a=>`__except__${new URL(a).origin}`)(a);return await t(e)})(e.url))&&(n=!1)}return n&&await chrome.tabs.discard(a,c)},o=async a=>{const t=`${e}${a.tabId}`;console.log("clear",t),await chrome.alarms.clear(t)},i=async a=>{if(!a.tabId)return;const c=`${e}${a.tabId}`;await chrome.alarms.clear(c);const n=await(async()=>await t("ttl")||6e5)();chrome.alarms.create(c,{when:Date.now()+n})},d=async a=>{const t=a.name.replace(e,"");t&&"undefined"!=t&&r(Number(t))};let m=null;chrome.runtime.onInstalled.addListener((()=>{chrome.tabs.onUpdated.addListener(c),chrome.tabs.onReplaced.addListener(c),chrome.tabs.onActivated.addListener((async a=>{await o(a),m&&i(m),m=a})),chrome.tabs.onRemoved.addListener((async a=>{m.tabId==a&&(m=void 0),await o({tabId:a}),c()})),chrome.alarms.onAlarm.addListener(d),(()=>{const e={};e[a]=!1,chrome.storage.local.set(e)})(),chrome.commands.onCommand.addListener((async a=>{if("cleanUp"==a)return(async()=>{(await s()).forEach((a=>!a.discarded&&r(a.tabId)))})()})),(async()=>{await chrome.alarms.clearAll(),(await s()).forEach(i)})()}))}();